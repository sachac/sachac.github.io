<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-01-21 Thu 23:31 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Evil plans</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Sacha Chua" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css"
href="//sachachua.com/blog/wp-content/themes/sacha-v3/foundation/css/foundation.min.css"></link>
<link rel="stylesheet" type="text/css" href="//sachachua.com/org-export.css"></link>
<link rel="stylesheet" type="text/css" href="//sachachua.com/blog/wp-content/themes/sacha-v3/style.css"></link>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="preamble" class="status">
<a name="top" id="top"></a>
</div>
<div id="content">
<h1 class="title">Evil plans</h1>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<div class="row"><div class="columns">

<p>
<a id="org9709d74"></a>
</p>


<div class="heading-status" width="200" height="200" style="float: right; width: 220px; background: white; padding: 10px" data-type="sunburst"></div>

<p>
Curious about anything? Contact me at sacha@sachachua.com .  
Web: <a href="https://sachachua.com/evil-plans">https://sachachua.com/evil-plans</a>
Raw files: <a href="https://github.com/sachac/sachac.github.io/tree/master/evil-plans">evil-plans</a>
</p>

<p>
Additional notes: <a href="http://sachachua.com/blog/2014/03/reflecting-goals-time/">http://sachachua.com/blog/2014/03/reflecting-goals-time/</a>
</p>

<div id="outline-container-Current_goals" class="outline-2">
<h2 id="Current_goals">Current goals</h2>
<div class="outline-text-2" id="text-Current_goals">
<p>
See raw file or end of document for code. 
</p>


<div id="org733005c" class="figure">
<p><object type="image/svg+xml" data="goals.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>

<div id="outline-container-Including__Someday__goals" class="outline-2">
<h2 id="Including__Someday__goals">Including "Someday" goals</h2>
<div class="outline-text-2" id="text-Including__Someday__goals">
<p>
See raw file or end of document for code.
</p>


<div id="org403bd78" class="figure">
<p><object type="image/svg+xml" data="someday.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>

<div id="outline-container-Goals" class="outline-2">
<h2 id="Goals">Goals&#xa0;&#xa0;&#xa0;<span class="tag"><span class="goal">goal</span></span></h2>
<div class="outline-text-2" id="text-Goals">
</div>

<div id="outline-container-tickle_my_brain_and_live_an_awesome_life" class="outline-3">
<h3 id="tickle_my_brain_and_live_an_awesome_life">tickle my brain and live an awesome life</h3>
<div class="outline-text-3" id="text-tickle_my_brain_and_live_an_awesome_life">
</div>
</div>

<div id="outline-container-fill_in_at_least_one_observation_for_each_specific_expectation_in_the_Ontario_Kindergarten_Program" class="outline-3">
<h3 id="fill_in_at_least_one_observation_for_each_specific_expectation_in_the_Ontario_Kindergarten_Program"><span class="todo TODO">TODO</span> fill in at least one observation for each specific expectation in the Ontario Kindergarten Program</h3>
<div class="outline-text-3" id="text-fill_in_at_least_one_observation_for_each_specific_expectation_in_the_Ontario_Kindergarten_Program">
<p>
so that I can <a href="#tickle_my_brain_and_live_an_awesome_life">tickle my brain and live an awesome life</a>
<a href="https://www.ontario.ca/document/kindergarten-program-2016/appendix-overall-expectations-related-specific-expectations">https://www.ontario.ca/document/kindergarten-program-2016/appendix-overall-expectations-related-specific-expectations</a>
</p>
</div>
</div>
<div id="outline-container-move_my_services_into_Docker_or_similar_containers" class="outline-3">
<h3 id="move_my_services_into_Docker_or_similar_containers"><span class="todo SOMEDAY">SOMEDAY</span> move my services into Docker or similar containers</h3>
<div class="outline-text-3" id="text-move_my_services_into_Docker_or_similar_containers">
<p>
So that I can <a href="#org1eaf8f4">make my server more reproducible</a>
(and make my setup easier to reproduce)
</p>
</div>
</div>
<div id="outline-container-help_the_Emacs_community_grow" class="outline-3">
<h3 id="help_the_Emacs_community_grow">help the Emacs community grow</h3>
<div class="outline-text-3" id="text-help_the_Emacs_community_grow">
<p>
so that I can <a href="#tickle_my_brain_and_live_an_awesome_life">tickle my brain and live an awesome life</a> 
</p>
</div>
<div id="outline-container-edit_the_rest_of_the_subtitles_for_EmacsConf" class="outline-4">
<h4 id="edit_the_rest_of_the_subtitles_for_EmacsConf"><span class="todo TODO">TODO</span> edit the rest of the subtitles for EmacsConf</h4>
<div class="outline-text-4" id="text-edit_the_rest_of_the_subtitles_for_EmacsConf">
<p>
so that I can <a href="#help_the_Emacs_community_grow">help the Emacs community grow</a> and make things more searchable
</p>

<p>
<a href="file:///home/sacha/orgzly/organizer.html#MissingReference">Edit another subtitle file</a>
</p>
</div>
</div>
<div id="outline-container-figure_out_a_workflow_for_pointing_to_Emacs_meetups" class="outline-4">
<h4 id="figure_out_a_workflow_for_pointing_to_Emacs_meetups"><span class="todo SOMEDAY">SOMEDAY</span> figure out a workflow for pointing to Emacs meetups</h4>
<div class="outline-text-4" id="text-figure_out_a_workflow_for_pointing_to_Emacs_meetups">
<p>
so that I can help people connect and <a href="#help_the_Emacs_community_grow">help the Emacs community grow</a>
</p>
</div>
</div>
<div id="outline-container-make_quick_screencasts_and_animated_GIFs" class="outline-4">
<h4 id="make_quick_screencasts_and_animated_GIFs"><span class="todo SOMEDAY">SOMEDAY</span> make quick screencasts and animated GIFs</h4>
<div class="outline-text-4" id="text-make_quick_screencasts_and_animated_GIFs">
<p>
so that I can <a href="#help_the_Emacs_community_grow">help the Emacs community grow</a>
</p>
</div>
</div>
<div id="outline-container-figure_out_signposts_and_maps" class="outline-4">
<h4 id="figure_out_signposts_and_maps"><span class="todo SOMEDAY">SOMEDAY</span> figure out signposts and maps</h4>
<div class="outline-text-4" id="text-figure_out_signposts_and_maps">
<p>
so that I can <a href="#help_the_Emacs_community_grow">help the Emacs community grow</a>
</p>
</div>
</div>
</div>
<div id="outline-container-orga8f3133" class="outline-3">
<h3 id="orga8f3133"><span class="todo SOMEDAY">SOMEDAY</span> make an EPUB3 read-aloud book that's also viewable through the web</h3>
<div class="outline-text-3" id="text-orga8f3133">
<p>
so that I can <a href="#tickle_my_brain_and_live_an_awesome_life">tickle my brain and live an awesome life</a> 
</p>

<p>
Readium looks promising. <a href="https://readium.firebaseapp.com/?epub=https%3A%2F%2Fcdn.rawgit.com%2FIDPF%2Fepub3-samples%2Fmaster%2F30%2Fmoby-dick-mo&amp;epubs=epub_content%2Fidpf_samples.opds&amp;goto=epubcfi(/6/14!/4/2/2%5Bc01h01%5D/1:0)">Sample</a>
<a href="https://github.com/readium/readium-js-viewer/blob/master/README.md">https://github.com/readium/readium-js-viewer/blob/master/README.md</a>
</p>
</div>
</div>

<div id="outline-container-org1eaf8f4" class="outline-3">
<h3 id="org1eaf8f4"><span class="todo SOMEDAY">SOMEDAY</span> make my server more reproducible</h3>
<div class="outline-text-3" id="text-org1eaf8f4">
<p>
so that I can <a href="#tickle_my_brain_and_live_an_awesome_life">tickle my brain and live an awesome life</a>
and so that I can restore from backups
</p>
</div>
</div>
</div>

<div id="outline-container-Old_graph" class="outline-2">
<h2 id="Old_graph">Old graph</h2>
<div class="outline-text-2" id="text-Old_graph">

<div id="org75b57a4" class="figure">
<p><a href="http://sachachua.com/sharing/goals.png" width="640"><img src="goals.png" alt="goals.png" width="640" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-Code" class="outline-2">
<h2 id="Code">Code</h2>
<div class="outline-text-2" id="text-Code">
<p>
Need to have graphviz installed.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org331e9f2">(<span class="org-keyword">let</span> ((count 0)
      (files
       (directory-files directory nil pattern)))
  (format <span class="org-string">"%d items - %d%%\n%s"</span>
          (length files)
          (/ (* 100.0 (length files)) target)
          (mapconcat
           (<span class="org-keyword">lambda</span> (x)
             (<span class="org-keyword">setq</span> count (1+ count))
             (format <span class="org-string">"%d. %s"</span> count (replace-regexp-in-string strip <span class="org-string">""</span> x)))
           files
           <span class="org-string">"\n"</span>)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgf1641b0">(<span class="org-keyword">defvar</span> <span class="org-variable-name">include-someday</span> nil)
(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/fill-string</span> (string new-fill-column <span class="org-type">&amp;optional</span> replace-char)
  <span class="org-doc">"Wrap STRING to NEW-FILL-COLUMN. Change newlines to REPLACE-CHAR."</span>
  (<span class="org-keyword">with-temp-buffer</span>
    (insert string)
    (<span class="org-keyword">let</span> ((fill-column new-fill-column))
      (fill-region (point-min) (point-max))
      (<span class="org-keyword">if</span> replace-char
          (<span class="org-keyword">progn</span>
            (goto-char (point-min))
            (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"\n"</span> nil t)
              (replace-match replace-char t t))))
      (buffer-string))))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-map-goals</span> (tag)
  <span class="org-doc">"Return an alist, based on the TAG tree and \"so that I can\" link structure.</span>
<span class="org-doc">  Structure: ((nodes . ((components) ...)) (edges . ((a . b) ...)))"</span>
  (<span class="org-keyword">let</span> (nodes edges)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Go through the entries</span>
    (org-map-entries
     (<span class="org-keyword">lambda</span> ()
       (<span class="org-keyword">let</span> ((heading (org-heading-components)))
         (<span class="org-keyword">when</span> (<span class="org-keyword">or</span> (not (elt heading 2)) (member (elt heading 2) (<span class="org-keyword">if</span> include-someday '(<span class="org-string">"TODO"</span> <span class="org-string">"WAITING"</span> <span class="org-string">"SOMEDAY"</span>) '(<span class="org-string">"TODO"</span>))))
           (<span class="org-keyword">save-excursion</span>
             (<span class="org-keyword">save-restriction</span>
               <span class="org-comment-delimiter">;; </span><span class="org-comment">Ignore subtrees in the body</span>
               (org-narrow-to-subtree)
               (<span class="org-keyword">save-excursion</span>
                 (org-set-property <span class="org-string">"CUSTOM_ID"</span> (replace-regexp-in-string <span class="org-string">"[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">A-Za-z0-9]"</span> <span class="org-string">"_"</span> (elt heading 4))))
               (end-of-line)
               (narrow-to-region
                (point-min)
                (<span class="org-keyword">if</span> (re-search-forward
                     (concat <span class="org-string">"[\r\n]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">"</span> org-outline-regexp <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>) nil t)
                    (match-beginning 1)
                  (point-max)))
               (goto-char (point-min))
               (<span class="org-keyword">when</span> (&gt; (car heading) 1)
                 (<span class="org-keyword">setq</span> nodes (cons heading nodes)))
               (<span class="org-keyword">when</span> (re-search-forward <span class="org-string">"so that I can"</span> nil t)
                 (<span class="org-keyword">while</span> (re-search-forward org-bracket-link-regexp (line-end-position) t)
                   (<span class="org-keyword">setq</span> edges (cons (cons (elt heading 4) (match-string-no-properties 1)) edges)))))))))
     tag)
    (list (cons 'nodes nodes) (cons 'edges edges))))

(<span class="org-keyword">defvar</span> <span class="org-variable-name">sacha/elgraphviz-attributes</span> '((<span class="org-builtin">:color</span> . <span class="org-string">"color"</span>)
                                      (<span class="org-builtin">:fontname</span> . <span class="org-string">"fontname"</span>)
                                      (<span class="org-builtin">:pad</span> . <span class="org-string">"pad"</span>)
                                      (<span class="org-builtin">:shape</span> . <span class="org-string">"shape"</span>)
                                      (<span class="org-builtin">:style</span> . <span class="org-string">"style"</span>)
                                      (<span class="org-builtin">:tooltip</span> . <span class="org-string">"tooltip"</span>)
                                      (<span class="org-builtin">:target</span> . <span class="org-string">"target"</span>)
                                      (<span class="org-builtin">:url</span> . <span class="org-string">"URL"</span>)
                                      (<span class="org-builtin">:width</span> . <span class="org-string">"width"</span>))
  <span class="org-doc">"List of attributes"</span>)


(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/elgraphviz-process-property-list</span> (prop-list)
  <span class="org-doc">"Convert PROP-LIST to an alphabetically sorted, comma-separated attribute list."</span>
  (mapconcat 'identity
             (delq nil
                   (mapcar (<span class="org-keyword">lambda</span> (x)
                             (<span class="org-keyword">if</span> (plist-get prop-list (car x))
                                 (format <span class="org-string">"%s=\"%s\""</span> (cdr x)
                                         (sacha/elgraphviz-quote-string (plist-get prop-list (car x))))))
                           sacha/elgraphviz-attributes))
             <span class="org-string">","</span>))

(<span class="org-keyword">ert-deftest</span> <span class="org-function-name">sacha/elgraphviz-process-property-list</span> ()
  (<span class="org-keyword">should</span> (string= (sacha/elgraphviz-process-property-list '(<span class="org-builtin">:width</span> 1)) <span class="org-string">"width=\"1\""</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/elgraphviz-quote-string</span> (string) <span class="org-doc">"Quote \" in strings."</span> (replace-regexp-in-string <span class="org-string">"\""</span> <span class="org-string">"\\\""</span> (format <span class="org-string">"%s"</span> string)))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/elgraphviz-node</span> (name <span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"Return the node definition for NAME with ARGS as attributes."</span>
  (<span class="org-keyword">if</span> args
      (format <span class="org-string">"\"%s\" [%s]"</span> (sacha/elgraphviz-quote-string name) (sacha/elgraphviz-process-property-list args))
    (format <span class="org-string">"\"%s\""</span> (sacha/elgraphviz-quote-string name))))
(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/elgraphviz-directed-edge</span> (a b <span class="org-type">&amp;rest</span> args)
  <span class="org-doc">"Return the node definition for NAME with ARGS as attributes."</span>
  (format <span class="org-string">"\"%s\" -&gt; \"%s\" [%s]"</span>
          (sacha/elgraphviz-quote-string a)
          (sacha/elgraphviz-quote-string b)
          (sacha/elgraphviz-process-property-list args)))

(<span class="org-keyword">ert-deftest</span> <span class="org-function-name">sacha/elgraphviz-node</span> ()
  (<span class="org-keyword">should</span> (string= (sacha/elgraphviz-node <span class="org-string">"Test"</span> <span class="org-builtin">:style</span> <span class="org-string">"filled"</span> <span class="org-builtin">:url</span> <span class="org-string">"http://example.com"</span> <span class="org-builtin">:tooltip</span> <span class="org-string">"test"</span>)
                   <span class="org-string">"\"Test\" [style=\"filled\",tooltip=\"test\",URL=\"http://example.com\"]"</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/elgraphviz-default-node</span> (<span class="org-type">&amp;rest</span> attributes)
  (format <span class="org-string">"node [%s]"</span> (sacha/elgraphviz-process-property-list attributes)))

(<span class="org-keyword">ert-deftest</span> <span class="org-function-name">sacha/elgraphviz-default-node</span> ()
  (<span class="org-keyword">should</span> (string= (sacha/elgraphviz-default-node <span class="org-builtin">:color</span> <span class="org-string">"#cccccc"</span> <span class="org-builtin">:width</span> 100)
                   <span class="org-string">"node [color=\"#cccccc\",width=\"100\"]"</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/elgraphviz-default-edge</span> (<span class="org-type">&amp;rest</span> attributes)
  (format <span class="org-string">"edge [%s]"</span> (sacha/elgraphviz-process-property-list attributes)))
(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/elgraphviz-attribute</span> (name val)
  (format <span class="org-string">"%s=\"%s\""</span> name (sacha/elgraphviz-quote-string val)))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/elgraphviz-digraph</span> (id <span class="org-type">&amp;rest</span> body)
  (concat <span class="org-string">"digraph "</span> id <span class="org-string">" {\n"</span>
          (mapconcat 'identity body <span class="org-string">"\n"</span>)
          <span class="org-string">"}"</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-map-to-graphviz</span> (map fill-column id)
  <span class="org-doc">"Convert MAP to a graphviz representation. Wrap titles at FILL-COLUMN."</span>
  (sacha/elgraphviz-digraph id
                            (sacha/elgraphviz-attribute <span class="org-string">"id"</span> id) 
                            (sacha/elgraphviz-default-node <span class="org-builtin">:shape</span> <span class="org-string">"box"</span> <span class="org-builtin">:fontname</span> <span class="org-string">"Open Sans"</span> <span class="org-builtin">:pad</span> 1) 
                            (sacha/elgraphviz-default-edge <span class="org-builtin">:color</span> <span class="org-string">"#CCCCCC"</span>) 
                            (mapconcat
                             (<span class="org-keyword">lambda</span> (x)
                               (sacha/elgraphviz-directed-edge 
                                (sacha/fill-string (car x) fill-column <span class="org-string">"\\n"</span>)
                                (sacha/fill-string (cdr x) fill-column <span class="org-string">"\\n"</span>)))
                             (cdr (assoc 'edges map)) <span class="org-string">"\n"</span>)
                            (mapconcat
                             (<span class="org-keyword">lambda</span> (x)
                               (sacha/elgraphviz-node
                                (sacha/fill-string (elt x 4) fill-column <span class="org-string">"\\n"</span>)
                                <span class="org-builtin">:style</span> (<span class="org-keyword">if</span> (null (elt x 2)) <span class="org-string">"filled"</span>)
                                <span class="org-builtin">:url</span> (concat <span class="org-string">"index.html#"</span> (replace-regexp-in-string <span class="org-string">"[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">A-Za-z0-9]"</span> <span class="org-string">"_"</span> (elt x 4)))
                                <span class="org-builtin">:target</span> <span class="org-string">"_parent"</span>
                                <span class="org-builtin">:tooltip</span> (elt x 4)))
                             (cdr (assoc 'nodes map)) <span class="org-string">"\n"</span>)))
(org-babel-execute:dot (sacha/org-map-to-graphviz (sacha/org-map-goals tag) fill-column id) (list (cons <span class="org-builtin">:file</span> outputfile) (cons <span class="org-builtin">:cmdline</span> cmdline)))
</pre>
</div>

<style type="text/css">
.back-to-top {
    position: fixed;
    bottom: 2em;
    right: 0px;
    text-decoration: none;
    color: #000000;
    background-color: rgba(235, 235, 235, 0.80);
    font-size: 12px;
    padding: 1em;
    display: none;
}

.back-to-top:hover {
    background-color: rgba(135, 135, 135, 0.50);
}
</style>

<a class="back-to-top" href="#top">Back to top</a>

<script type="text/javascript">
    var offset = 220;
    var duration = 500;
    $(window).scroll(function() {
        if (jQuery(this).scrollTop() > offset) {
            jQuery('.back-to-top').fadeIn(duration);
        } else {
            jQuery('.back-to-top').fadeOut(duration);
        }
    });
</script>

</div></div><!-- columns, row-->

  <style type="text/css">
  .Green { fill: green; color: white; background: green}
  .Yellow { fill: yellow; background: yellow }
  .Red { fill: red; color: white; background: red }
  svg .heading { cursor: pointer; stroke: 2px white; }
  path.heading.todo { fill: green }
  path.heading.someday { fill: gray }
  </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
<script type="text/javascript">
// Returns a hierarchical JSON of the tree structure
function buildHeadingTree() {
  var lastNode = {level: 0, children: []};
  var root = lastNode;
  var headings = $(':header');
  for (var i = 0; i < headings.length; i++) {
    var matches = headings[i].tagName.match(/[0-9]+/);
    var level = +(matches[0]);
    while (level <= lastNode.level && lastNode.parent) {
      lastNode = lastNode.parent;
    }
    var newNode = {parent: lastNode,
                   children: [],
                   level: level,
                   element: headings[i]};
    lastNode.children.push(newNode);
    lastNode = newNode;
  }
  return root;
}

function classValue(d) {
  var m = d.element.innerHTML.match(/TODO|SOMEDAY|DONE/i);
  return ((m && m[0]) || 'TODO') + ' heading';
//  return d.element.innerHTML.match(/Green|Yellow|Red/i)[0];
}
function labelValue(d) {
  return '<a href="#' + d.element.id + '">' + d.element.innerHTML + '</a>';
}

// Code from https://bl.ocks.org/mbostock/1005873
// Draws the chart of status
function drawHeadingStatusChart(output, data) {
  var width = output.attr('width'),
      height = output.attr('height'),
      partition = d3.layout.partition()
        .value(function(d) { return 1; }),
      svg = output.append('svg').attr('width', width).attr('height', height),
      breadcrumbs = output.append('div').attr('class', 'heading-breadcrumbs'),
      clickHandler = function(d) { window.location.hash = '#' + d.element.id; },
      showBreadcrumbs = function(d) {
      var links = [labelValue(d)];
      while (d.parent) {
        d = d.parent;
        if (d.element) {
        links.unshift(labelValue(d));
        }
      }
      breadcrumbs.html(links.join(' &lt; '));
  };
  if (output.attr('data-type') == 'sunburst') {
    var radius = Math.min(width, height) / 2;
    svg = svg.append('g').attr('transform', 'translate(' + (width / 2) + ',' + (height / 2) + ')');
    var x = d3.scale.linear().range([0, 2 * Math.PI]),
        y = d3.scale.sqrt().range([0, radius]),
        arc = d3.svg.arc()
    .startAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x))); })
    .endAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x + d.dx))); })
    .innerRadius(function(d) { return Math.max(0, y(d.y)); })
    .outerRadius(function(d) { return Math.max(0, y(d.y + d.dy)); }),
    path = svg.selectAll('path').data(partition(data))
                  .enter().append('path').attr('d', arc)
                  .attr('class', classValue)
                  .on('click', clickHandler)
                  .on('mouseover', showBreadcrumbs);
  } else {
    var x = d3.scale.linear().range([0, width]),
        y = d3.scale.linear().range([0, height]),
        rect = svg.selectAll('rect');
        rect.data(partition(data))  
          .enter()
          .append('rect')
          .attr('x', function(d) { return x(d.x); })
          .attr('y', function(d) { return y(d.y); })
          .attr('width', function(d) { return x(d.dx); })
          .attr('height', function(d) { return y(d.dy); })
          .attr('class', classValue)
          .on('mouseover', showBreadcrumbs)
          .on('click', clickHandler);
  }
}

function addClassToHeadings() {
  var headings = $(':header');
  for (var i = 0; i < headings.length; i++) {
    $(headings[i]).addClass(classValue({element: headings[i]}));
  }
}

$(document).ready(function() {
  drawHeadingStatusChart(d3.select('.heading-status'),  
   buildHeadingTree().children[0]);
  addClassToHeadings();
});
</script>
</div>
</div>
</div>
<div id="postamble" class="status">

<style type="text/css">
.back-to-top {
    position: fixed;
    bottom: 2em;
    right: 0px;
    text-decoration: none;
    color: #000000;
    background-color: rgba(235, 235, 235, 0.80);
    font-size: 12px;
    padding: 1em;
    display: none;
}

.back-to-top:hover {
    background-color: rgba(135, 135, 135, 0.50);
}
</style>

<div class="back-to-top">
<a href="#top">Back to top</a> | <a href="mailto:sacha@sachachua.com">E-mail me</a>
</div>

<script type="text/javascript">
    var offset = 220;
    var duration = 500;
    jQuery(window).scroll(function() {
        if (jQuery(this).scrollTop() > offset) {
            jQuery('.back-to-top').fadeIn(duration);
        } else {
            jQuery('.back-to-top').fadeOut(duration);
        }
    });
</script>
</div>
</body>
</html>
